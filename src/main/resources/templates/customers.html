<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title>Customers - PaymentSystem</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
<div th:fragment="content">
    <div class="container mt-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h2>Customers</h2>
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createCustomerModal">Create New Customer</button>
        </div>

        <table class="table table-bordered" id="customerTable">
            <thead>
            <tr>
                <th>ID</th>
                <th>First Name</th>
                <th>Last Name</th>
                <th>Birth Date</th>
                <th>Fin Code</th>
                <th>Phone</th>
                <th>Email</th>
                <th>Registered</th>
                <th>Status</th>
            </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <div class="modal fade" id="createCustomerModal" tabindex="-1">
        <div class="modal-dialog">
            <form id="createCustomerForm" class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Create Customer</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="text" class="form-control mb-2" id="firstName" placeholder="First Name" required>
                    <input type="text" class="form-control mb-2" id="lastName" placeholder="Last Name" required>
                    <input type="date" class="form-control mb-2" id="birthDate" required>
                    <input type="text" class="form-control mb-2" id="finCode" placeholder="Fin Code" required>
                    <input type="text" class="form-control mb-2" id="phoneNumber" placeholder="Phone (+994xxxxxxxxx)" required>
                    <input type="email" class="form-control mb-2" id="email" placeholder="Email" required>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary">Create</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        function fetchCustomers() {
            axios.get('/api/v1/customer')
                .then(res => {
                    const tbody = document.querySelector("#customerTable tbody");
                    tbody.innerHTML = '';
                    res.data.forEach(c => {
                        const row = `
                            <tr>
                                <td>${c.customerId}</td>
                                <td>${c.firstName}</td>
                                <td>${c.lastName}</td>
                                <td>${c.birthDate}</td>
                                <td>${c.finCode}</td>
                                <td>${c.phoneNumber}</td>
                                <td>${c.email}</td>
                                <td>${c.registrationDate}</td>
                                <td>${c.status}</td>
                            </tr>`;
                        tbody.innerHTML += row;
                    });
                });
        }

        document.getElementById('createCustomerForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const customer = {
                firstName: document.getElementById('firstName').value,
                lastName: document.getElementById('lastName').value,
                birthDate: document.getElementById('birthDate').value,
                finCode: document.getElementById('finCode').value,
                phoneNumber: document.getElementById('phoneNumber').value,
                email: document.getElementById('email').value
            };

            axios.post('/api/v1/customer', customer)
                .then(() => {
                    fetchCustomers();
                    const modal = bootstrap.Modal.getOrCreateInstance(document.getElementById('createCustomerModal'));
                    modal.hide();
                    this.reset();
                });
        });

        fetchCustomers();
    </script>
</div>
</body>
</html>
